# 작업 기록 (2026-02-11 07:45)

## 요약
- 인코딩이 깨진 `defect_beta_guide.md`를 영문 가이드로 교체.
- DB 설정을 로컬 프로파일/환경변수로 분리하고 `application-local.yml` 추가.
- `.gitignore`에 `application-local.yml` 추가.
- 실행 스크립트와 Playwright 실행 커맨드에 `SPRING_PROFILES_ACTIVE=local` 반영.
- Playwright의 JDK 경로 하드코딩 제거, `JAVA_HOME` 기반으로 변경.
- `setup_and_run.ps1`의 `JAVA_HOME` 설정/따옴표 처리 개선.
- 구동 실패 원인 분석: `SPRING_PROFILES_ACTIVE` 값에 따옴표가 붙어 `application-local.yml` 미적용 → DB URL 미설정.
- 상세 로그 추출 후 위 원인 확인.

## 변경된 파일
- `defect_beta/defect_beta_guide.md`: 영문 가이드로 교체.
- `defect_beta/src/main/resources/application.yml`: 환경변수 분리 및 주석 정리.
- `defect_beta/src/main/resources/application-local.yml`: 로컬 DB 설정 추가.
- `defect_beta/.gitignore`: `application-local.yml` 추가.
- `defect_beta/setup_and_run.ps1`: `SPRING_PROFILES_ACTIVE=local` 반영 및 cmd 인용 처리 개선.
- `defect_beta/playwright.config.js`: `SPRING_PROFILES_ACTIVE=local` 반영 및 `JAVA_HOME` 의존 방식으로 변경.

## 실행/진단 기록
- `setup_and_run.ps1` 실행 시 `JAVA_HOME` 경로 오류 → 인용 처리 개선.
- 재실행 시 `bootRun` 실패 → `--stacktrace --info`로 상세 로그 추출.
- 원인: 프로파일명이 `local"`로 찍혀 `application-local.yml` 미적용.

## 확인한 UI 관련 값
- 신규 결함 등록 팝업 가로 크기: `1000px` (`test_view.html`의 `const width = 1000`).
- 대시보드 폰트 크기:
  - `h1`: `1.75rem`
  - `.stat-label`: `0.875rem`
  - `.stat-value`: `2.25rem`
- 목록 화면(테이블) 폰트 크기:
  - `th`: `0.75rem`
  - `td`: `0.9375rem`

## 추가 작업 (이미지 저장 경로 개선)
- `defect_manage`, `defect_beta` 각각에 `images` 폴더 생성.
- 이미지(Base64 Data URL)를 서버에서 `images` 폴더에 저장하고, DB에는 `/images/<파일명>` 경로를 저장하도록 변경.
- 파일명은 결함번호(`defect_id`)로 저장하며, 중복 시 `_1`, `_2` 일련번호 자동 부여.
- 클라이언트에서 이미지 다운로드 저장 로직 제거.

### 변경 파일
- `defect_manage/server.js`
- `defect_manage/public/js/app.js`
- `defect_beta/src/main/java/com/defect/beta/controller/DefectController.java`
- `defect_beta/src/main/java/com/defect/beta/storage/ImageStorage.java` (신규)
- `defect_beta/src/main/java/com/defect/beta/config/WebConfig.java` (신규)
- `defect_beta/src/main/resources/static/js/app.js`
- `defect_manage/images` (신규 폴더)
- `defect_beta/images` (신규 폴더)

## 추가 작업 (기존 이미지 마이그레이션)
- `defect_manage/data/defects.json`에 저장된 base64 이미지를 `defect_manage/images`로 이동 후 `screenshot`을 `/images/<파일명>`으로 갱신.
- `defect_beta`(Supabase)의 `defects` 테이블에서 base64 이미지 데이터를 조회하여 `defect_beta/images`로 저장 후 경로 업데이트.
- 파일명 규칙: `defect_id` 기반, 중복 시 `_1`, `_2` 일련번호 부여.

### 결과
- `defect_manage`: `/images`로 변경 7건, `data:image` 잔존 0건.
- `defect_beta`: 1건 마이그레이션 완료(일부 데이터는 base64 손상 시 보존).
