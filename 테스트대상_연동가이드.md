# DefectFlow Integration Guide (Client-Side Widget)

이 가이드는 테스트 대상인 웹사이트에 **'결함 등록 버튼(Widget)'**을 추가하여, 테스트 중에 즉시 결함을 보고할 수 있도록 설정하는 방법을 설명합니다. 이 버튼은 `defect_manage` 시스템(GitHub Pages)과 연동되어 동작합니다.

*   **관리 도구 URL**: [https://mohenz.github.io/defect_manage/](https://mohenz.github.io/defect_manage/)
*   **연동 예시 페이지**: [https://mohenz.github.io/defect_manage/test_view/test_view.html](https://mohenz.github.io/defect_manage/test_view/test_view.html)

---

## 1. Quick Integration (Script Tag)

테스트 대상 웹사이트의 `</body>` 태그 바로 위에 아래 스크립트를 삽입하면 '결함 리포트' 플로팅 버튼이 나타납니다.

```html
<!-- DefectFlow Report Widget -->
<div id="defectflow-widget-container"></div>
<script>
(function() {
    const DEFECTFLOW_URL = "https://mohenz.github.io/defect_manage/"; // 배포된 URL

    // 1. 필요한 아이콘 로딩
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
    document.head.appendChild(link);

    // 2. 위젯 스타일 정의
    const style = document.createElement('style');
    style.innerHTML = `
        #defectflow-report-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 9999;
            width: 60px; height: 60px; border-radius: 50%;
            background: #ef4444; color: white; border: none;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 24px; transition: all 0.3s;
        }
        #defectflow-report-btn:hover { transform: scale(1.1); background: #dc2626; }
        #defectflow-report-btn span { 
            position: absolute; right: 70px; background: #1e293b; color: white;
            padding: 5px 12px; border-radius: 4px; font-size: 13px; font-weight: 600;
            white-space: nowrap; visibility: hidden; opacity: 0; transition: 0.2s;
        }
        #defectflow-report-btn:hover span { visibility: visible; opacity: 1; right: 75px; }
    `;
    document.head.appendChild(style);

    // 3. 버튼 생성
    const btn = document.createElement('button');
    btn.id = 'defectflow-report-btn';
    btn.innerHTML = '<i class="fas fa-bug"></i><span>결함 리포트</span>';
    btn.onclick = function() {
        const width = 1200;
        const height = 900;
        const left = (window.screen.width / 2) - (width / 2);
        const top = (window.screen.height / 2) - (height / 2);
        
        // 현재 화면 정보를 LocalStorage에 저장하여 새 창에서 읽을 수 있게 함
        const pendingData = {
            title: `[${document.title}] 결함 보고`,
            menu_name: "운영 사이트",
            screen_name: document.title,
            screen_url: window.location.href,
            env_info: `Browser: ${navigator.userAgent}`,
            test_type: "사용자 테스트"
        };
        localStorage.setItem('pending_defect', JSON.stringify(pendingData));

        window.open(
            `${DEFECTFLOW_URL}#register?mode=standalone`, 
            'DefectFlowReport', 
            `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`
        );
    };
    document.body.appendChild(btn);
})();
</script>
```

---

## 2. 작동 원리

1.  **플로팅 버튼**: 웹사이트 우측 하단에 빨간색 버그 아이콘 버튼이 생성됩니다.
2.  **데이터 캡처**: 버튼 클릭 시 현재 페이지의 **Title, URL, 접속 환경(User Agent)** 정보를 자동으로 수집합니다.
3.  **데이터 전달**: 수집된 초기 정보는 브라우저의 `localStorage`를 통해 `defect_manage` 시스템으로 전달됩니다.
4.  **연동 등록**: `defect_manage` 시스템이 팝업으로 열리며, 수집된 정보가 입력 폼에 자동으로 채워진 상태로 나타납니다.

---

## 3. 커스터마이징

### 3.1 버튼 디자인 수정
`style.innerHTML` 내부의 CSS 값을 수정하여 버튼의 색상(`#ef4444`), 위치(`bottom: 20px`), 크기 등을 변경할 수 있습니다.

### 3.2 수집 항목 추가
`pendingData` 객체에 추가 필드를 정의하면, 결함 등록 시 더 많은 정보를 자동으로 입력할 수 있습니다.

---

## 4. 주의 사항

*   **배포 URL**: `DEFECTFLOW_URL` 상수는 반드시 본인이 배포한 GitHub Pages 주소로 설정해야 합니다.
*   **보안**: 이 위젯은 현재 페이지의 URL과 접근 가능한 DOM 정보만 수집하며, 민감한 개인 정보는 수집하지 않도록 설계되었습니다.
